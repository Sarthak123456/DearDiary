{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Dear Diary</title>
  <!-- Bootstrap core CSS-->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <!-- Custom fonts for this template-->
  <link href="{% static 'vendor/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">
  <!-- Custom styles for this template-->
  <link href="{% static 'css/sb-admin.css' %}" rel="stylesheet">
  <link href="{% static 'css/custom_css.css' %}" rel="stylesheet">
 
</head>

<body class="fixed-nav sticky-footer bg-dark " id="page-top">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="/">Dear Diary</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
        
        
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a class="nav-link" href="/index">
            <i class="fa fa-fw fa-home"></i>
            <span class="nav-link-text">Dashboard</span>
          </a>
        </li>
        
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="View all">
          <a class="nav-link" href="/view">
            <i class="fa fa-fw fa-table"></i>
            <span class="nav-link-text">View All</span>
          </a>
        </li>
       
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Logout">
          <a class="nav-link" href="/logout">
            <i class="fa fa-fw fa-sign-out"></i>
            <span class="nav-link-text">Logout</span>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav sidenav-toggler">
        <li class="nav-item">
          <a class="nav-link text-center" id="sidenavToggler">
            <i class="fa fa-fw fa-angle-left"></i>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          <form class="form-inline my-2 my-lg-0 mr-lg-2">
            <div class="input-group">
              <form action=''  method='GET'>
              <input class="form-control" type="text"  name='q' value='{{ request.GET.q }}' placeholder="Search..">
              <span class="input-group-btn">
                <button class="btn btn-primary" type="submit">
                  </form>
                  <i class="fa fa-search"></i>
                </button>
              </span>
            </div>
          </form>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right">
          <a class="nav-link" href="/index">
            <i class="fa fa-fw fa-user-circle"></i>
            <span class="nav-link-text">{{ user.username }}</span>
          </a>
        </li>
        
      </ul>
    </div>
  </nav>

     {% block main_content %}
    {% endblock %}

    
  
    <!-- /.container-fluid-->
    <!-- /.content-wrapper-->
    <footer class="sticky-footer">
      <div class="container">
        <div class="text-center">
          <small>Copyright © Your Website 2017</small>
        </div>
      </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fa fa-angle-up"></i>
    </a>
    <!-- Final Page Modal-->
   
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            
            <h5 class="modal-title" id="exampleModalLabel">{{ dog.title|title }}</h5>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
                      </div>
          <div class="modal-body">
            <div class='row'>
              <div class='col-md-9'>
            {{ dog.description }}
            </div>
              
<div class="col-md-3">
    {% if dog.image %}
            <a href='#'><img src='/media/{{ dog.image }}' class="img img-responsive image" width='300'/> </a>
                <a href="/delete-image/{{ dog.id }}" class='demo'>Delete</a></p>{% endif %}
                 <a class="btn btn-primary" href="/edit/{{ dog.id }}">Edit</a>
            </div>
            
          </div><hr>
          
        </div>
      </div>
    </div>
   
    
    <!-- Bootstrap core JavaScript-->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}" ></script>
    <script src='{% static "vendor/bootstrap/js/bootstrap.bundle.min.js" %}'></script>
    <!-- Core plugin JavaScript-->
    <script src='{% static "vendor/jquery-easing/jquery.easing.min.js" %}'></script>
    
    <!-- Custom scripts for all pages-->
    <script src='{% static "js/sb-admin.min.js" %}'></script>
<script type="text/javascript">
  $(".js-create-book").click(function(e){
    
    var addressValue = $(this).attr("href");
    
        //alert(addressValue );
        e.preventDefault();
       $.ajax({
      url: addressValue,
      type: 'get',
      success: function(data) {
        //console.log(data);
        //var table = $('#exampleModla').tableToJSON();
        //console.log(table);
        //alert(JSON.stringify(table)); 
        // var myElement = data.getElementById("#exampleModal");
       
        var jq=jQuery(data);
        var title = jq.find(".modal-title");
        var description = jq.find(".modal-body");
        //var image=jq.find('.img');
        //var iamge = jq.find(".modal-body");
        //console.log(x)
        var t= $(document).find('.modal-title').replaceWith(title);
        //t.fadeToggle('fast');
        var d = $(document).find('.modal-body').replaceWith(description); 
       //var i = $(document).find('.img').replaceWith(image);
         $(document).find("#exampleModal").css('padding-right' , 0);
        // d.fadeToggle(30000);
        //$('#exampleModal').modal('show');
        
       
    }
    });
  });
//$(document).ready(function(){
  //var x = 10;
//  var width = 0;
  //$( window ).scroll(function() {
  //width= width + x;
//  console.log(width);
//  });

//$('body').on('scroll', '.image', function() {
//  $('.image').css({
    
  //  'width': '10px',
  //});
  //});
  var x = 100;
 var width = 500;
 console.log($(window).height());
 $(".change").on('wheel', function(e) {
     
  if (e.originalEvent.deltaY < 0) {
    e.preventDefault();
    width= width + x;
    //console.log(width);
    
    if (width >= $(window).height()){
     $('.img-modal').css('overflow', 'scroll');
    }
     
  } else {
    e.preventDefault();
     width= width - x;
     if (width < $(window).height()) {
      $('.img-modal').css('overflow', 'hidden');
      $('html, body').animate({scrollTop: '0px'}, 500);
    }
    
 //console.log(width);
  }
  $('.change').css('height', width);
 
  
});


   $('body').on('click', '.image', function(){
   // $('body').toggleClass('scrollbar');
  
  //  $('.image').animate({
   //   'width': width,
    //  'text-align': 'middle',
    //  'top': '0',
    //  'bottom': '0',
     // 'right': '0',
     // 'left': '0',
     // 'position' : 'fixed',
    //});
    var src= $(this).attr('src');
    $('.change').attr('src', src);
    $('.img-modal').toggleClass('showing');
    $('body').toggleClass('scrollbar');
    
    
});
 
//});

$('.demo').click(function(e){
  var answer = confirm('Are you sure to delete this??');
  if(answer == true){
    $('demo').hide();
  }
  else{
    e.preventDefault();
  }
});
$(document).ready(function(){
  $("#image_upload").click(function(){
    $('#image_update').remove();
  });
});

$(document).ready(function(){
  $('#image_form').submit(function(e){
    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});

  // e.preventDefault();
     var formData= new FormData($('#image_form')[0]);
// var file_data = $('#image').prop('files')[0];
// var formData = new FormData($('#image_form')[0]);
//   formData.append('file', file_data);
    $.ajax({
      
      xhr:function(){
        
        var xhr= new window.XMLHttpRequest();
        xhr.upload.addEventListener('progress', function(e){
          
          if( e.lengthComputable){
            
            console.log('Bytes Loaded ' + e.loaded);
            console.log('Total size ' + e.total);
            console.log('Percentage  Uploaded ' + (e.loaded / e.total)*100 + '%');
            
            var percent = Math.round((e.loaded / e.total)*100);
            
            $('.progress-bar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%');
            
            
          }
          
        });
        
        return xhr;
        
      },
      
      type:'POST',
      url:'/create',
      processData: false,
      contentType: false,
      data:formData,
      success:function(data){
        alert('Entry Saved!!');
      console.log(data);  
      console.log(formData);
      
      }
      
    });
    
  });
  
});

</script>
  
  </div>
</body>

</html>
